package me.EthanBilbrey.MobsMultiplyOnSight;

import java.util.List;

import org.bukkit.Bukkit;
import org.bukkit.entity.Entity;
import org.bukkit.entity.Player;
import org.bukkit.util.Vector;

public class PlayerTracker 
{
	private Player p;
	private int taskId;
	
	public PlayerTracker(Player p) 
	{
		this.p = p;
		startTracking();
	}
	private void startTracking() 
	{
		taskId = Bukkit.getScheduler().scheduleSyncRepeatingTask(Main.getPlugin(Main.class), () -> {
			List<Entity> entities = p.getNearbyEntities(10, 10, 10);
			Vector dir = p.getLocation().getDirection();
			for(Entity e : entities) 
			{
				Vector dirToEnt = p.getEyeLocation().toVector().subtract(e.getLocation().toVector());
				Double dot = dirToEnt.normalize().dot(dir);
				
				p.sendMessage("Value: " + dot);
				if(dot < 0.98D) 
				{
					if(!(e instanceof Player)) 
					{
						p.sendMessage("looking at mob");
						p.getWorld().spawnEntity(e.getLocation(), e.getType());
					}
				}
			}
		}, 0L, 10L);
	}
	public void cancelTask() 
	{
		Bukkit.getScheduler().cancelTask(taskId);
	}
	public Player getPlayer() 
	{
		return p;
	}
}
